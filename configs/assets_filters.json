{
    "comments": [
        "имя модуля - имя папки куда оно будет складывать результат",
        "запрос должен отдавать в конце как минимум поле asset_id с *host.@id, это необходимо для дальнейшей обработки событий",
        "specific_politics соответствуют формату event_policies.json",
        "default_politics_blacklist - политики из event_policies, которые НУЖНО применить (re2)",
        "default_politics_whitelist - политики из event_policies, которые НЕ НУЖНО применять (re2)",
        "если вам нужно чтобы применились все дефолтные политики, то просто не пишите полей: specific_politics, default_politics_blacklist и default_politics_whitelist",
        "если нужно выкинуть какие-то дефолтные политики - заполните default_politics_whitelist",
        "если нужно наоборот явно указать определенные дефолтные политики - заполните default_politics_blacklist",
        "технически можно указать оба варианта, но black стоит выше в условии и это не будет работать",
        "specific_politics применяется поверх политик файла, они дополнительные",
        "техническую поддержку осуществляет @ping_localhost"
    ],
    "AD_DC_by_domain": {
        "comment": [
            "Поиск доменных контроллеров указанных в доменах.",
            "То есть, из домена собирается информация о ДК и склеивается с активами по FQDN, это позволяет найти ДК в закрытых или удаленных сегментах.",
            "Кроме стандартных политик сбора событий для OS Windows должны также собираться события ДК w AD DC"
        ],
        "PDQL": [
            "select(",
            "    ActiveDirectory.Domains.Name as name, ",
            "    ActiveDirectory.Domains.Computers.DnsHostName as DnsHostName, ",
            "    ActiveDirectory.Domains.Computers.DomainRole, ",
            "    ActiveDirectory.Domains.Computers.objectSid) | ",
            "filter(",
            "    ActiveDirectory.Domains.Computers.DomainRole like '%Domain Controller%') | ",
            "join(select (@host, host.@description, host.fqdn, host.@audittime, host.@ScanningInfo.Type, host.@ScanningInfo.Status) | filter(host.@ScanningInfo.Type = 'Audit') as H, ",
            "    H.host.fqdn = DnsHostName) | ",
            "select(name, DnsHostName, H.@host, H.host.@description, H.host.@audittime, H.host.@ScanningInfo.Status) | ",
            "calc(TotalDays(now() - H.host.@AuditTime) as dur_audit)"
        ],
        "default_politics_blacklist": "^(sw AD |w os Win (Ess|sys)|sa )"
    },
    "AD_Domain_Servers_by_domain": {
        "comment": [
            "Поиск серверов указанных в доменах.",
            "То есть, из домена собирается информация о серверах и склеивается с активами по FQDN, это позволяет найти сервера в закрытых или удаленных сегментах."
        ],
        "PDQL": [
            "select(",
            "    ActiveDirectory.Domains.Name as name, ",
            "    ActiveDirectory.Domains.Computers.DnsHostName as DnsHostName, ",
            "    ActiveDirectory.Domains.Computers.DomainRole,",
            "    ActiveDirectory.domains.computers.objectSid as hostSID,",
            "    ActiveDirectory.domains.objectSid as domain_sid) | ",
            "filter(",
            "    ActiveDirectory.Domains.Computers.DomainRole like '%Domain Server%') | ",
            "join(",
            "    select(ActiveDirectory.domains.objectSid as domain_sid,",
            "    ActiveDirectory.domains.groups.SamAccountName as gr_name,",
            "    ActiveDirectory.domains.groups.allmembers.objectSid as mem_id)",
            "    as gr, gr.domain_sid = domain_sid and gr.mem_id = hostSID)",
            "| join(select (@host, host.@description, host.fqdn, host.osname, host.osversion, host.@audittime, host.@ScanningInfo.Type, host.@ScanningInfo.Status) | filter(host.@ScanningInfo.Type = 'Audit') as H, ",
            "    H.host.fqdn = DnsHostName) | ",
            "select(name, DnsHostName, compactunique(gr.gr_name) as groups, H.@host, H.host.@description, H.host.fqdn, H.host.osname, H.host.osversion, H.host.@audittime, H.host.@ScanningInfo.Status) | ",
            "calc(TotalDays(now() - H.host.@AuditTime) as dur_audit) "
        ],
        "default_politics_blacklist": "^(sw |w os Win (Ess|sys)|sa )"
    },
    "AD_WorkStation": {
        "comment": [
            "Поиск рабочих станций указанных в доменах.",
            "То есть, из домена собирается информация о компьютерах и склеивается с активами по FQDN, это позволяет найти компьютеры в закрытых или удаленных сегментах."
        ],
        "PDQL": [
            "select(",
            "    ActiveDirectory.Domains.Name as name, ",
            "    ActiveDirectory.Domains.Computers.DnsHostName as DnsHostName, ",
            "    ActiveDirectory.Domains.Computers.DomainRole,",
            "    ActiveDirectory.domains.computers.objectSid as hostSID,",
            "    ActiveDirectory.domains.objectSid as domain_sid) |",
            "filter(",
            "    ActiveDirectory.Domains.Computers.DomainRole like '%Domain Workstation%') | ",
            "join(",
            "    select(ActiveDirectory.domains.objectSid as domain_sid,",
            "    ActiveDirectory.domains.groups.SamAccountName as gr_name,",
            "    ActiveDirectory.domains.groups.allmembers.objectSid as mem_id)",
            "    as gr, gr.domain_sid = domain_sid and gr.mem_id = hostSID)",
            "| join(select (@host, host.@description, host.fqdn, host.@audittime, host.@ScanningInfo.Type, host.@ScanningInfo.Status) | filter(host.@ScanningInfo.Type = 'Audit') as H, ",
            "    H.host.fqdn = DnsHostName) | ",
            "select(name, DnsHostName, compactunique(gr.gr_name) as groups, H.@host, H.host.@description, H.host.@audittime, H.host.@ScanningInfo.Status) | ",
            "calc(TotalDays(now() - H.host.@AuditTime) as dur_audit) "
        ],
        "default_politics_blacklist": [
            "w os Win (Ess|sysmon)",
            "^sa"
        ]
    },
    "NON_AD_windows": {
        "comment": [
            "Поиск всех компьютеров с ОС windows, которые не указаны в известных доменах"
        ],
        "PDQL": [
            "select(@windowshost, windowshost.@description, windowshost.fqdn, windowshost.@audittime, windowshost.@ScanningInfo.Type, windowshost.@ScanningInfo.Status) | filter(windowshost.@ScanningInfo.Type = 'Audit') ",
            "| calc(TotalDays(now() - windowshost.@AuditTime) as dur_audit)",
            "| join(select(ActiveDirectory.Domains.Name as name, ",
            "    ActiveDirectory.Domains.Computers.DnsHostName as DnsHostName,",
            "    ActiveDirectory.domains.computers.objectSid as hostSID) as AD, windowshost.fqdn = AD.DnsHostName)",
            "| filter(AD.DnsHostName = null) |",
            "select(@windowshost, windowshost.@description, windowshost.fqdn, windowshost.@audittime, windowshost.@ScanningInfo.Status, dur_audit, AD.name) "
        ],
        "default_politics_blacklist": [
            "w os Win (Ess|sysmon)",
            "^sa"
        ]
    },
    "unixhosts": {
        "comment": [
            "Поиск всех узлов с ОС на базе ядра Linux"
        ],
        "PDQL": [
            "filter(unixhost) | select(@unixhost, unixhost.@description, unixhost.@id as asset_id, unixhost.@audittime, unixhost.@ScanningInfo.Type, unixhost.@ScanningInfo.Status) | filter(unixhost.@ScanningInfo.Type = 'Audit')"
        ],
        "default_politics_blacklist": "^(u os |sa? )"
    }
}